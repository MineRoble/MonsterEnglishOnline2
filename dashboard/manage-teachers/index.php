<?php
    $GLOBALS["page-title"] = "교사 관리";

    include_once $_SERVER["DOCUMENT_ROOT"]."/_includes/_config.php";
    include_once $_SERVER["DOCUMENT_ROOT"]."/_includes/_header.php";
    include_once $_SERVER["DOCUMENT_ROOT"]."/dashboard/_dashboard_header.php";
?>
    <main>
        <p class="h1 fw-bold mb-3">교사 관리</p>

        <div class="row gap-3" id="view">
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
        </div>
    </main>

    <script>
        function load() {
            document.getElementById("view").innerHTML = `
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>
            <div class="d-flex flex-column gap-3 p-0 border rounded placeholder-glow" style="width: 18rem;">
                <div class="ratio ratio-1x1 placeholder"></div>
                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                    <div class="d-flex flex-column">
                        <p class="h5 mb-3 placeholder col-6"></p>
                        <p>
                            <span class="placeholder col-7"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-4"></span>
                            <span class="placeholder col-6"></span>
                            <span class="placeholder col-8"></span>
                        </p>
                    </div>
                    <a href="#" class="btn btn-primary disabled placeholder"></a>
                </div>
            </div>`;

            fetch("load.php", {
                method: "POST"
            })
            .then(response => {
                if (!response.ok) {
                throw new Error('에러 발생: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                if(data['header']['result'] == "success") {
                    let insertHTML = "";
                    data['body']['teachers'].forEach(function(item,index,arr2){
                        insertHTML += `
                            <div class="d-flex flex-column gap-3 p-0 border rounded" style="width: 18rem;">
                                <div class="ratio ratio-1x1" style="background-image: url('/assets/teachers/?idx=${item["idx"]}'); background-position: center; background-size: contain; background-repeat: no-repeat;"></div>
                                <div class="flex-grow-1 d-flex flex-column justify-content-between mb-3 mx-3">
                                    <div class="d-flex flex-column">
                                        <p class="h5 mb-3">${item["name"]}</p>
                                        <p>${item["description"]}</p>
                                    </div>
                                    <a href="modify/?idx=${item["idx"]}" class="btn btn-primary">수정</a>
                                </div>
                            </div>`;
                    })
                    document.getElementById("view").innerHTML = insertHTML + `
                            <div class="d-flex flex-column gap-3 p-0 border rounded" style="width: 18rem;">
                                <div class="ratio ratio-1x1" style="background-image: url('/assets/teachers/'); background-position: center; background-size: contain; background-repeat: no-repeat;"></div>
                                <div class="d-flex flex-column mb-3 mx-3">
                                    <p class="h5 mb-3">새로운 교사 추가하기</p>
                                    <p>아래 <code>추가</code> 버튼을 클릭하여 새로운 교사 추가하기</p>
                                    <a href="./add/" class="btn btn-success">추가</a>
                                </div>
                            </div>`;
                } else {
                    alert(data['header']['message']);
                }
            })
            .catch(error => {
                alert("서버와 통신 중에 오류가 발생했습니다.");
                console.log(error);
            });
        }

        window.addEventListener('load', () => {
            load();
        });
    </script>
<?php
    include_once $_SERVER["DOCUMENT_ROOT"]."/dashboard/_dashboard_footer.php";
    include_once $_SERVER["DOCUMENT_ROOT"]."/_includes/_footer.php";
?>